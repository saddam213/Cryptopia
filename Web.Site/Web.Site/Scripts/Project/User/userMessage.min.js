function itemSelect(n){var i=$("#list-message"),r=i.data("action"),t=n,u=t.data("messageid");i.find(".inbox-item").removeClass("active");t.addClass("active");$("#message-delete, #message-reply, #message-report").removeAttr("disabled");$("#message-target").empty();getPartial("#message-target",r+"?messageId="+u,!1,function(){t.data("unread")==="True"&&(t.removeClass("text-bold"),t.find(".msg-icon").removeClass("fa-envelope").addClass("fa-envelope-o"),t.attr("data-unread",!1),updateUnreadcount())})}function updateUnreadcount(){var n=$("#list-message").find(".text-bold").length;$(".unread-message-count").html(n>0?n:"")}function appendoutbox(n){var t=$("#messageTemplate").html();$("#list-message").prepend(Mustache.render(t,{IsInbound:"False",MessageId:n.Id,Unread:"False",TextClass:"",IconClass:"fa-envelope-o",Sender:n.Recipiants,Time:Resources.UserMessages.MessagesJustNowLabel,Subject:n.Subject}));$(".inbox-item").off("click").on("click",function(){itemSelect($(this))});setEmptyListMessage();updateUnreadcount()}function appendinbox(n){var t=$("#messageTemplate").html();$("#list-message").prepend(Mustache.render(t,{IsInbound:"True",MessageId:n.Id,Unread:"True",TextClass:"text-bold",IconClass:"fa-envelope",Sender:n.Sender,Time:Resources.UserMessages.MessagesJustNowLabel,Subject:n.Subject}));$(".inbox-item").off("click").on("click",function(){itemSelect($(this))});setEmptyListMessage();updateUnreadcount()}function setEmptyListMessage(){$("#emptyListMessage-inbox, #emptyListMessage-outbox").hide();var n=$("#list-message"),t=n.data("isinbox");t==!0&&n.find("[data-inbox='True']").length==0?$("#emptyListMessage-inbox").show():t==!1&&n.find("[data-inbox='False']").length==0&&$("#emptyListMessage-outbox").show()}$("#message-new").on("click",function(){var n=$(this).data("action");openModalGet(n,{},function(n){showMessage(n);n.Success&&$("#selection-outbox").trigger("click")})});$("#message-reply").on("click",function(){var t=$(this).data("action"),n=$("#list-message .active").data("messageid");n&&openModalGet(t,{messageId:n},function(n){showMessage(n);n.Success&&$("#selection-outbox").trigger("click")})});$("#message-report").on("click",function(){var t=$(this).data("action"),n=$("#list-message .active").data("messageid");n&&openModalGet(t,{messageId:n},function(n){showMessage(n)})});$(".inbox-item").on("click",function(){itemSelect($(this))});$("#message-delete").on("click",function(){var t=$(this).data("action"),n=$("#list-message .inbox-item.active").data("messageid");n&&confirm(Resources.UserMessages.MessagesDeleteQuestionTitle,Resources.UserMessages.MessagesDeleteQuestion,function(){postJson(t,{messageId:n},function(t){t.Success&&($("#list-message").find("[data-messageid='"+n+"']").remove(),$("#message-target").empty());showMessage(t);setEmptyListMessage();updateUnreadcount()})})});$("#message-deleteaall").on("click",function(){var t=$(this).data("action"),n=$("#list-message").data("isinbox"),i=n?Resources.UserMessages.MessagesDeleteAllInboxQuestionTitle:Resources.UserMessages.MessagesDeleteAllOutboxQuestionTitle,r=n?Resources.UserMessages.MessagesDeleteAllInboxQuestion:Resources.UserMessages.MessagesDeleteAllOutboxQuestion;confirm(i,r,function(){postJson(t,{inbox:n},function(t){if(t.Success){var i=n?$("#list-message").find("[data-inbox='True']"):$("#list-message").find("[data-inbox='False']");i.remove();$("#message-target").empty()}showMessage(t);setEmptyListMessage();updateUnreadcount()})})});$("#message-search").on("change keyup paste",function(){var n=$(this).val(),t=$("#list-message").data("isinbox"),i=t?$("#list-message").find("[data-inbox='True']"):$("#list-message").find("[data-inbox='False']");$.each(i,function(){var t=$(this),r=$(t).find(".search-data"),i="";$.each(r,function(){i+=$(this).text()+" "});i.toLowerCase().indexOf(n.toLowerCase())==-1?t.hide():t.show()})});$("#selection-inbox").on("click",function(){$("#message-target").empty();$(".inbox-btns").show();$(".message-type").html("Inbox");$("#message-search").attr("placeholder",Resources.UserMessages.MessagesInboxTabSearchPlaceholder);$("#message-delete, #message-reply, #message-report").attr("disabled","disabled");var n=$("#list-message");n.data("isinbox",!0);n.find(".inbox-item").removeClass("active");n.find("[data-inbox='True']").show();n.find("[data-inbox='False']").hide();$("#selection-inbox").addClass("btn-info");$("#selection-outbox").removeClass("btn-info");setEmptyListMessage();updateUnreadcount()}).trigger("click");$("#selection-outbox").on("click",function(){$("#message-target").empty();$(".inbox-btns").hide();$(".message-type").html("Outbox");$("#message-search").attr("placeholder",Resources.UserMessages.MessagesOutboxTabSearchPlaceholder);$("#message-delete, #message-reply, #message-report").attr("disabled","disabled");var n=$("#list-message");n.data("isinbox",!1);n.find(".inbox-item").removeClass("active");n.find("[data-inbox='True']").hide();n.find("[data-inbox='False']").show();$("#selection-outbox").addClass("btn-info");$("#selection-inbox").removeClass("btn-info");setEmptyListMessage();updateUnreadcount()});$("#inbox-container").height($(".profile-sidebar").height()-($(".settings-page-header-container").outerHeight()+$(".message-searchbar").outerHeight()+10));$(document).off("OnInboxMessage").on("OnInboxMessage",function(n,t){appendinbox(t)});$(document).off("OnOutboxMessage").on("OnOutboxMessage",function(n,t){appendoutbox(t)});$("#messageTarget").addClass("user-tabtarget");